#!/bin/bash

homeUser=/home/"$(whoami)"
directory="$homeUser"/login_email

find /home/ -type f -size -8k | grep "login_email"

if [ $? -eq 1 ]
then
    touch $directory
    echo "login=$(whoami)" > $directory
    echo "email=" >> $directory
fi

emailField=$(grep "email=" "$directory")


getUserId() {
    userId=""
    until [ "$userId" = $(whoami) ]
    do
        userId=$(dialog --no-cancel --title "$title" --inputbox "Digite seu login" 10 35 --stdout)
    done

    echo $userId
}

getUserEmail() {
    userEmail=""
    until [[ $userEmail == *"home"* ]]
    do
        userEmail=$(dialog --no-cancel --title "$title" --inputbox "Digite seu email" 10 35 --stdout)
    done

    echo $userEmail
}

getUserApproval() {
    dialog --title "$title" --msgbox "Você será redirecionado ao sistema de cadastro" 10 35
    dialog --title "$title" --yesno "Deseja continuar?" 10 35 

    return $?
}

while [ ${#emailField} -lt 7 ]
do
    title="Sistema de cadastro de email"

    if getUserApproval;
    then
        echo "login=$(getUserId)" > $directory
        echo "email=$(getUserEmail)" >> $directory

        emailField=$(grep "email=" "$directory")
    else
        exit 1
    fi

done
